"use strict";module.exports=function(e){var n=require("q");if("undefined"==typeof e)var e={};var r=1274,i=9360,t={vendorId:r,productId:i},o={permissions:[{usbDevices:[t]}]};e.checkPermission=function(){var e=n.defer();return chrome.permissions.contains(o,function(n){n?e.resolve():e.reject()}),e.promise},e.requestPermission=function(){var e=n.defer();return chrome.permissions.request(o,function(n){n?e.resolve():e.reject()}),e.promise};var c,s,u;e.openDevice=function(){var e=n.defer();return chrome.usb.getDevices(t,function(n){chrome.usb.findDevices(t,function(r){r&&r.length>0?(s=r[0],c=n[0],chrome.usb.listInterfaces(s,function(n){u=n[0],v(),f().then(e.resolve)})):e.reject()})}),e.promise};var f=function(){var e=n.defer();return chrome.usb.claimInterface(s,u.interfaceNumber,e.resolve),e.promise},d={interrupt:{},"in":{},out:{}},v=function(){u.endpoints.forEach(function(e){"in"==e.direction&&"interrupt"==e.type?d.interrupt=e:"in"==e.direction&&"bulk"==e.type?d["in"]=e:"out"==e.direction&&"bulk"==e.type&&(d.out=e)})},a=function(){this.handlers=[]};return a.prototype={addListener:function(e){this.handlers.push(e)},removeListener:function(e){this.handlers=this.handlers.filter(function(n){return n!==e?n:void 0})},fire:function(e,n){var r=n||window;this.handlers.forEach(function(n){n.call(r,e)})}},e.onDeviceRemoved=new a,chrome.usb.onDeviceRemoved.addListener(function(n){n.device==c.device&&e.onDeviceRemoved.fire()}),e};